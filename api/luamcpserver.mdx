---
title: "LuaMCPServer"
description: "Connect external tools via Model Context Protocol (MCP) servers"
---

## Overview

`LuaMCPServer` allows you to connect external MCP (Model Context Protocol) servers to your agent. MCP servers provide additional tools that your agent can use at runtime, enabling integration with file systems, databases, APIs, and more.

```typescript
import { LuaMCPServer } from 'lua-cli';

const filesystemServer = new LuaMCPServer({
  name: 'filesystem',
  transport: 'stdio',
  command: 'npx',
  args: ['-y', '@modelcontextprotocol/server-filesystem', '/data']
});

export default filesystemServer;
```

<Note>
**What is MCP?** The Model Context Protocol (MCP) is an open standard for connecting AI models to external tools and data sources. Learn more at [modelcontextprotocol.io](https://modelcontextprotocol.io).
</Note>

## Why MCP Servers?

<CardGroup cols={2}>
  <Card title="Extend Capabilities" icon="puzzle-piece">
    Add tools without writing code - use existing MCP servers
  </Card>
  <Card title="Standard Protocol" icon="plug">
    Compatible with any MCP-compliant server
  </Card>
  <Card title="Local or Remote" icon="globe">
    Run servers locally (stdio) or connect to remote endpoints (SSE)
  </Card>
  <Card title="Community Ecosystem" icon="users">
    Access growing library of community MCP servers
  </Card>
</CardGroup>

## Transport Types

MCP servers support two transport methods:

<Tabs>
  <Tab title="stdio (Local)">
    **Best for:** Local execution, npm packages, CLI tools
    
    The server runs as a local process. Your agent communicates via stdin/stdout.
    
    ```typescript
    const localServer = new LuaMCPServer({
      name: 'filesystem',
      transport: 'stdio',
      command: 'npx',
      args: ['-y', '@modelcontextprotocol/server-filesystem', '/data']
    });
    ```
  </Tab>

  <Tab title="sse (Remote)">
    **Best for:** Remote servers, hosted services, APIs
    
    The server runs remotely. Your agent connects via Server-Sent Events (SSE).
    
    ```typescript
    const remoteServer = new LuaMCPServer({
      name: 'docs-server',
      transport: 'sse',
      url: 'https://mcp.example.com/sse',
      headers: {
        'Authorization': 'Bearer my-api-key'
      }
    });
    ```
  </Tab>
</Tabs>

## Constructor

### new LuaMCPServer(config)

Creates a new MCP server configuration.

<ParamField path="config" type="LuaMCPServerConfig" required>
  MCP server configuration object
</ParamField>

## Configuration Parameters

### Required Fields

<ParamField path="name" type="string" required>
  Unique identifier for the MCP server
  
  **Format**: lowercase, hyphens allowed
  
  **Examples**: `'filesystem'`, `'github-server'`, `'database'`
</ParamField>

<ParamField path="transport" type="'stdio' | 'sse'" required>
  Transport protocol for communication
  
  - `'stdio'` - Local process via stdin/stdout
  - `'sse'` - Remote server via Server-Sent Events
</ParamField>

### stdio Transport Fields

<ParamField path="command" type="string" required={false}>
  Command to execute the MCP server
  
  **Required when:** `transport: 'stdio'`
  
  **Examples**: `'npx'`, `'node'`, `'python'`
</ParamField>

<ParamField path="args" type="string[]">
  Arguments to pass to the command
  
  **Example**: `['-y', '@modelcontextprotocol/server-filesystem', '/data']`
</ParamField>

<ParamField path="env" type="Record<string, string>">
  Environment variables for the server process
  
  **Example**: `{ 'API_KEY': 'secret123' }`
</ParamField>

### SSE Transport Fields

<ParamField path="url" type="string" required={false}>
  URL of the remote MCP server
  
  **Required when:** `transport: 'sse'`
  
  **Example**: `'https://mcp.example.com/sse'`
</ParamField>

<ParamField path="headers" type="Record<string, string>">
  HTTP headers to send with requests
  
  **Example**: `{ 'Authorization': 'Bearer token' }`
</ParamField>

### Optional Fields

<ParamField path="timeout" type="number">
  Timeout in milliseconds for server operations
  
  **Default**: `60000` (60 seconds)
</ParamField>

## Examples

### Filesystem Access

```typescript
import { LuaMCPServer } from 'lua-cli';

const filesystemServer = new LuaMCPServer({
  name: 'filesystem',
  transport: 'stdio',
  command: 'npx',
  args: ['-y', '@modelcontextprotocol/server-filesystem', '/allowed/path'],
  timeout: 30000
});

export default filesystemServer;
```

### GitHub Integration

```typescript
import { LuaMCPServer } from 'lua-cli';

const githubServer = new LuaMCPServer({
  name: 'github',
  transport: 'stdio',
  command: 'npx',
  args: ['-y', '@modelcontextprotocol/server-github'],
  env: {
    'GITHUB_PERSONAL_ACCESS_TOKEN': 'ghp_xxxx'
  }
});

export default githubServer;
```

### Remote Database Server

```typescript
import { LuaMCPServer } from 'lua-cli';

const databaseServer = new LuaMCPServer({
  name: 'database',
  transport: 'sse',
  url: 'https://db-mcp.example.com/sse',
  headers: {
    'Authorization': 'Bearer db-api-key',
    'X-Database': 'production'
  },
  timeout: 45000
});

export default databaseServer;
```

### Brave Search

```typescript
import { LuaMCPServer } from 'lua-cli';

const braveSearch = new LuaMCPServer({
  name: 'brave-search',
  transport: 'stdio',
  command: 'npx',
  args: ['-y', '@anthropic/mcp-server-brave-search'],
  env: {
    'BRAVE_API_KEY': 'your-brave-api-key'
  }
});

export default braveSearch;
```

## Using with LuaAgent

MCP servers are added to your agent configuration:

```typescript
import { LuaAgent, LuaSkill } from 'lua-cli';
import filesystemServer from './mcp/filesystem';
import githubServer from './mcp/github';

const coreSkill = new LuaSkill({
  name: 'core-skill',
  description: 'Core functionality',
  tools: [...]
});

export const agent = new LuaAgent({
  name: 'enhanced-agent',
  persona: 'You are an assistant with access to files and GitHub.',
  skills: [coreSkill],
  
  // Add MCP servers
  mcpServers: [
    filesystemServer,
    githubServer
  ]
});
```

## Lifecycle Management

### Compile

During `lua compile`, MCP servers are:
1. Detected from your source code
2. Registered with the server (if new)
3. Assigned an ID stored in `lua.skill.yaml`
4. Configuration written to `dist/mcp-servers.json`

### Push

Push individual MCP server:

```bash
lua push mcp
# Select server from list
```

Or push all components:

```bash
lua push all --force
```

### Activate / Deactivate

MCP servers start inactive. Activate to make tools available:

```bash
lua mcp activate
# Select server to activate

lua mcp deactivate
# Select server to deactivate
```

### List / Delete

```bash
lua mcp list              # Show all MCP servers
lua mcp delete            # Remove an MCP server
```

## YAML Configuration

After compilation, `lua.skill.yaml` tracks MCP servers:

```yaml
agent:
  agentId: your-agent-id
  persona: ...

mcpServers:
  - name: filesystem
    mcpServerId: mcp_abc123
  - name: github
    mcpServerId: mcp_def456
```

<Note>
The YAML only stores `name` and `mcpServerId`. The full configuration (command, args, url, etc.) lives in your source code.
</Note>

## Best Practices

<AccordionGroup>
  <Accordion title="✅ Use Environment Variables for Secrets">
    Never hardcode API keys or tokens
    
    ```typescript
    // ✅ Good
    env: {
      'GITHUB_TOKEN': process.env.GITHUB_TOKEN
    }
    
    // ❌ Bad
    env: {
      'GITHUB_TOKEN': 'ghp_hardcoded_token'
    }
    ```
  </Accordion>

  <Accordion title="✅ Set Appropriate Timeouts">
    Adjust timeout based on expected operation duration
    
    ```typescript
    // Quick operations
    timeout: 10000  // 10 seconds
    
    // Database queries
    timeout: 30000  // 30 seconds
    
    // File processing
    timeout: 120000 // 2 minutes
    ```
  </Accordion>

  <Accordion title="✅ Restrict Paths for Filesystem Access">
    Only expose necessary directories
    
    ```typescript
    // ✅ Specific allowed path
    args: ['-y', '@modelcontextprotocol/server-filesystem', '/app/uploads']
    
    // ❌ Too permissive
    args: ['-y', '@modelcontextprotocol/server-filesystem', '/']
    ```
  </Accordion>

  <Accordion title="✅ Activate Only What You Need">
    Keep unused servers deactivated to reduce overhead
    
    ```bash
    # Activate only when needed
    lua mcp activate github-server
    
    # Deactivate when done
    lua mcp deactivate github-server
    ```
  </Accordion>
</AccordionGroup>

## Popular MCP Servers

| Server | Description | Install |
|--------|-------------|---------|
| Filesystem | Read/write local files | `@modelcontextprotocol/server-filesystem` |
| GitHub | GitHub API integration | `@modelcontextprotocol/server-github` |
| Brave Search | Web search via Brave | `@anthropic/mcp-server-brave-search` |
| SQLite | SQLite database access | `@modelcontextprotocol/server-sqlite` |
| Postgres | PostgreSQL database | `@modelcontextprotocol/server-postgres` |
| Google Drive | Google Drive files | `@anthropic/mcp-server-gdrive` |

<Note>
Check [modelcontextprotocol.io/servers](https://modelcontextprotocol.io) for the full list of available MCP servers.
</Note>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Server not found after push">
    Make sure the server is activated:
    
    ```bash
    lua mcp list      # Check status
    lua mcp activate  # Activate if needed
    ```
  </Accordion>

  <Accordion title="Command not found (stdio)">
    Ensure the command is installed and in PATH:
    
    ```bash
    # Test the command directly
    npx -y @modelcontextprotocol/server-filesystem --help
    ```
  </Accordion>

  <Accordion title="Connection timeout (sse)">
    Check the URL is accessible and increase timeout:
    
    ```typescript
    const server = new LuaMCPServer({
      transport: 'sse',
      url: 'https://...',
      timeout: 120000  // Increase timeout
    });
    ```
  </Accordion>

  <Accordion title="Authentication failed">
    Verify your API key or token is correct:
    
    ```typescript
    headers: {
      'Authorization': `Bearer ${process.env.MCP_API_KEY}`
    }
    ```
  </Accordion>
</AccordionGroup>

## Related APIs

<CardGroup cols={2}>
  <Card title="LuaAgent" href="/api/luaagent" icon="robot">
    Agent configuration with MCP servers
  </Card>
  <Card title="LuaSkill" href="/api/luaskill" icon="puzzle-piece">
    Custom tool collections
  </Card>
  <Card title="Environment" href="/api/environment" icon="key">
    Managing environment variables
  </Card>
  <Card title="MCP Command" href="/cli/mcp-command" icon="terminal">
    CLI management commands
  </Card>
</CardGroup>

## See Also

- [MCP Servers Overview](/overview/mcp-servers) - Conceptual introduction
- [MCP Command](/cli/mcp-command) - CLI management
- [LuaAgent](/api/luaagent) - Adding MCP servers to your agent

