---
title: "User API"
description: "Access and manage user profile data"
---

## Overview

The User API provides access to the current user's profile information through a powerful `UserDataInstance` class with direct property access.

```typescript
import { User } from 'lua-cli';

// Get user instance
const user = await User.get();

// Direct property access (NEW! ‚ú®)
console.log(user.name);
console.log(user.email);

// Update user data
await user.update({ name: "John Doe" });
```

## Features

<CardGroup cols={2}>
  <Card title="Direct Access" icon="bolt">
    Access properties with `user.name` instead of `user.data.name`
  </Card>
  <Card title="Auto Sanitization" icon="shield">
    Removes sensitive fields automatically
  </Card>
  <Card title="Built-in Methods" icon="wrench">
    `update()` and `clear()` included
  </Card>
  <Card title="Type-Safe" icon="code">
    Full TypeScript support
  </Card>
</CardGroup>

## get()

Retrieve the current user's data as a UserDataInstance.

```typescript
User.get(): Promise<UserDataInstance>
```

**Returns:** `UserDataInstance` with proxy-based property access

**Example:**

```typescript
import { User } from 'lua-cli';

// In your tool
async execute(input: any, context: ToolContext) {
  const user = await User.get();
  // or
  const user = context.user;  // Available through context
  
  // Direct property access
  console.log(user.name);    // "John Doe"
  console.log(user.email);   // "john@example.com"
  console.log(user.phone);   // "555-0123"
  
  return { userName: user.name };
}
```

## UserDataInstance API

### Property Access (Direct)

Access any user property directly:

```typescript
// Reading properties
const name = user.name;
const email = user.email;
const preferences = user.preferences;
const customField = user.customField;

// Setting properties (local only - call update() to persist)
user.name = "Jane Doe";
user.email = "jane@example.com";
user.preferences = { theme: "dark" };

// Checking existence
if ('name' in user) {
  console.log('User has a name');
}
```

### update()

Update user data on the server and locally.

```typescript
user.update(data: Record<string, any>): Promise<any>
```

<ParamField path="data" type="object" required>
  Object containing fields to update or add
</ParamField>

**Returns:** Promise resolving to updated sanitized user data

**Examples:**

```typescript
// Update single field
await user.update({ name: "John Doe" });

// Update multiple fields
await user.update({
  name: "John Doe",
  email: "john@example.com",
  phone: "555-1234"
});

// Update nested objects
await user.update({
  preferences: {
    theme: "dark",
    notifications: true,
    language: "en"
  }
});

// Access updated data immediately
console.log(user.name);  // "John Doe"
console.log(user.preferences.theme);  // "dark"
```

### clear()

Clear all user data for the current user.

```typescript
user.clear(): Promise<boolean>
```

**Returns:** Promise resolving to `true` if successful

**Example:**

```typescript
try {
  const success = await user.clear();
  if (success) {
    console.log('User data cleared successfully');
  }
} catch (error) {
  console.error('Failed to clear user data:', error);
}
```

<Warning>
**Destructive operation!** This removes all user data. Use with caution.
</Warning>

## Data Sanitization

UserDataInstance automatically removes sensitive fields:

**Removed (not accessible):**
- `agentId`
- `userId`

**Available (accessible):**
- `name`, `email`, `phone`
- Custom fields you set
- Preferences and settings
- Any other data

```typescript
// Server returns:
{
  userId: "12345",       // ‚ùå Removed
  agentId: "agent-123",  // ‚ùå Removed
  name: "John Doe",      // ‚úÖ Accessible
  email: "john@example.com"  // ‚úÖ Accessible
}

// Your user instance has:
{
  name: "John Doe",
  email: "john@example.com"
}
```

## Complete Examples

### Example 1: User Preferences

```typescript
import { LuaTool } from 'lua-cli';
import { z } from 'zod';

export class ManagePreferencesTool implements LuaTool {
  name = "manage_preferences";
  description = "Manage user preferences";
  
  inputSchema = z.object({
    theme: z.enum(['light', 'dark']).optional(),
    notifications: z.boolean().optional(),
    language: z.string().optional()
  });

  async execute(input: any, context: ToolContext) {
    const user = context.user;
    
    // Direct property access
    const currentPrefs = user.preferences || {};
    
    // Merge with new preferences
    const newPrefs = {
      ...currentPrefs,
      ...input
    };
    
    // Update on server
    await user.update({ preferences: newPrefs });
    
    return {
      message: 'Preferences updated successfully',
      preferences: user.preferences  // Direct access to updated data
    };
  }
}
```

### Example 2: Shopping Cart Persistence

```typescript
export class CartTool implements LuaTool {
  name = "manage_cart";
  description = "Manage shopping cart";
  
  inputSchema = z.object({
    action: z.enum(['add', 'remove', 'get']),
    productId: z.string().optional(),
    quantity: z.number().optional()
  });

  async execute(input: any, context: ToolContext) {
    const user = context.user;
    
    // Get current cart (direct access)
    let cart = user.cart || [];
    
    if (input.action === 'add') {
      cart.push({
        productId: input.productId,
        quantity: input.quantity
      });
      await user.update({ cart });
    }
    
    if (input.action === 'remove') {
      cart = cart.filter(item => item.productId !== input.productId);
      await user.update({ cart });
    }
    
    return {
      cart: user.cart,  // Direct access
      itemCount: cart.length
    };
  }
}
```

### Example 3: User Profile Management

```typescript
export class ProfileTool implements LuaTool {
  name = "update_profile";
  description = "Update user profile information";
  
  inputSchema = z.object({
    firstName: z.string().optional(),
    lastName: z.string().optional(),
    phone: z.string().optional(),
    bio: z.string().optional()
  });

  async execute(input: any, context: ToolContext) {
    const user = context.user;
    
    // Update user data
    await user.update(input);
    
    // Return updated profile (direct access)
    return {
      success: true,
      profile: {
        firstName: user.firstName,
        lastName: user.lastName,
        phone: user.phone,
        bio: user.bio
      },
      message: 'Profile updated successfully'
    };
  }
}
```

### Example 4: Personalized Greeting

```typescript
export class GreetUserTool implements LuaTool {
  name = "greet_user";
  description = "Greet user with personalized message";
  
  inputSchema = z.object({});

  async execute(input: any, context: ToolContext) {
    const user = context.user;
    
    // Direct property access
    const hour = new Date().getHours();
    const timeGreeting = hour < 12 ? 'Good morning'
      : hour < 18 ? 'Good afternoon'
      : 'Good evening';
    
    return {
      message: `${timeGreeting}, ${user.name}! How can I help you today?`
    };
  }
}
```

## Best Practices

<AccordionGroup>
  <Accordion title="‚úÖ Use Direct Property Access">
    ```typescript
    // ‚úÖ Recommended
    const name = user.name;
    const email = user.email;
    
    // üü° Still works but verbose
    const name = user.data.name;
    const email = user.data.email;
    ```
  </Accordion>

  <Accordion title="‚úÖ Batch Updates">
    Combine multiple updates into one call:
    
    ```typescript
    // ‚úÖ Good - Single update call
    await user.update({
      name: "John Doe",
      email: "john@example.com",
      phone: "555-1234"
    });
    
    // ‚ùå Bad - Multiple update calls
    await user.update({ name: "John Doe" });
    await user.update({ email: "john@example.com" });
    await user.update({ phone: "555-1234" });
    ```
  </Accordion>

  <Accordion title="‚úÖ Handle Missing Fields">
    Not all fields may be present:
    
    ```typescript
    const phone = user.phone || 'Not provided';
    const name = user.name || 'Guest';
    const preferences = user.preferences || {};
    ```
  </Accordion>

  <Accordion title="‚úÖ Use for Personalization">
    ```typescript
    // Personalized responses
    return {
      message: `Welcome back, ${user.name}!`,
      savedItems: user.cart?.length || 0,
      lastVisit: user.lastSeen
    };
    ```
  </Accordion>

  <Accordion title="‚ö†Ô∏è Remember to Call update()">
    Setting properties locally doesn't persist:
    
    ```typescript
    // ‚ùå Won't persist
    user.name = "John";
    
    // ‚úÖ Persists to server
    user.name = "John";
    await user.update({ name: user.name });
    
    // ‚úÖ Better: Update directly
    await user.update({ name: "John" });
    ```
  </Accordion>
</AccordionGroup>

## TypeScript Support

```typescript
interface UserDataInstance {
  // Properties (dynamic based on stored data)
  name?: string;
  email?: string;
  phone?: string;
  [key: string]: any;
  
  // Methods
  update(data: Record<string, any>): Promise<any>;
  clear(): Promise<boolean>;
  toJSON(): Record<string, any>;
}
```

### Usage with Types

```typescript
// Define your user data shape
interface MyUserData {
  name: string;
  email: string;
  preferences: {
    theme: 'light' | 'dark';
    notifications: boolean;
  };
}

// Access with type safety
const user = context.user;
const name: string = user.name;
const theme = user.preferences?.theme || 'light';
```

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Data API"
    icon="database"
    href="/api/data"
  >
    Store custom user data
  </Card>
  <Card
    title="User Data Examples"
    icon="layer-group"
    href="/examples/user-data"
  >
    See working examples
  </Card>
</CardGroup>

