---
title: "Changelog"
description: "Release notes and version history for lua-cli"
---

## v3.5.0-alpha.6

**Released:** February 11, 2026

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="Variable References in Primitive Config">
    You can now define primitive properties using variables and imports ‚Äî not just inline literals. Previously, extracting values to a variable would cause the compiler to silently ignore them.

    ```typescript
    // All of these now work:
    const MY_SCHEDULE = { type: 'cron', expression: '0 9 * * *' };
    const MY_TOOLS = [calculatorTool, weatherTool];
    import { RETRY_CONFIG } from './config';

    export const myJob = defineJob({
      schedule: MY_SCHEDULE,        // ‚úÖ variable reference
      retry: RETRY_CONFIG,          // ‚úÖ imported constant
      execute: async () => { ... }
    });

    export const mySkill = defineSkill({
      tools: MY_TOOLS,              // ‚úÖ variable reference
    });
    ```

    **Supported for:**
    - Job `schedule` and `retry` configuration
    - Skill `tools` arrays
    - MCP server resolver functions
    - All agent config arrays (`jobs`, `tools`, `webhooks`, `preProcessors`, `postProcessors`, `mcpServers`)
  </Accordion>

  <Accordion title="Complete Push All ‚Äî Persona & Backup Included">
    `lua push all` previously skipped persona and backup, requiring separate commands. Now it pushes everything in one go:

    ```bash
    # Pushes all primitives + persona + backup
    lua push all --force

    # Also deploys persona to production
    lua push all --force --auto-deploy
    ```

    **What's included now:**
    - All versioned primitives (skills, webhooks, jobs, preprocessors, postprocessors)
    - Agents and MCP servers
    - Persona (deployed to production when `--auto-deploy` is set)
    - Source backup

    Persona and backup failures are non-fatal ‚Äî the rest of the push completes normally.
  </Accordion>
</AccordionGroup>

### üêõ Bug Fixes

<AccordionGroup>
  <Accordion title="Agent Config Arrays With Variables">
    Defining agent primitive arrays via variables (e.g. `jobs: MY_JOBS`) previously caused the compiler to silently produce an agent with 0 jobs/tools/webhooks. This is now fixed:

    ```typescript
    const MY_JOBS = [dailyCleanup, weeklyReport];
    new LuaAgent({
      jobs: MY_JOBS,       // was silently ignored, now works
      webhooks: [myHook],  // inline still works too
    });
    ```

    Also applies to `skill.addTools(MY_TOOLS)`.
  </Accordion>

  <Accordion title="Webhook headerSchema Now Works">
    Webhooks defining `headerSchema` previously had their header validation silently dropped due to a key mapping bug. This is now fixed ‚Äî header validation schemas are correctly pushed to the server.
  </Accordion>
</AccordionGroup>

## v3.5.0

**Released:** February 10, 2026

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="Auto-Add dist-v2/ to .gitignore">
    The CLI now automatically adds `dist-v2/` to your `.gitignore` file to keep compiled output out of version control.

    - **New projects**: `lua init` template includes `dist-v2/` in `.gitignore`
    - **Existing projects**: Added automatically after the first successful compilation
    - Creates `.gitignore` if missing; idempotent (safe to run multiple times)
  </Accordion>

  <Accordion title="Project Backup & Restore">
    Backup your project source files to cloud storage for disaster recovery and team collaboration.

    ```bash
    # Backup project sources
    lua push backup

    # Restore on new machine
    lua init --agent-id abc123 --restore-sources
    ```

    **Key Features:**
    - Content-addressed storage with automatic deduplication
    - Efficient incremental backups (only changed files uploaded)
    - Full project recovery on new machines
    - Perfect for disaster recovery and team collaboration

    See the [Skill Management](/cli/skill-management#lua-push-backup) documentation for details.
  </Accordion>

  <Accordion title="CI/CD Mode (--ci flag)">
    New global `--ci` flag makes the CLI fail loudly on missing required arguments instead of silently hanging in non-TTY environments.

    ```bash
    # In CI/CD pipelines
    lua --ci push skill --name mySkill --set-version ${{ github.sha }} --force

    # In local development (interactive prompts work normally)
    lua push skill
    ```

    **Benefits:**
    - Fails immediately with clear error messages in CI/CD
    - Prevents silent hangs waiting for input in automated environments
    - Auto-detects non-TTY environments and shows helpful warnings

    See the [Non-Interactive Mode](/cli/non-interactive-mode#cicd-mode-ci-flag) documentation.
  </Accordion>

  <Accordion title="Agents Discovery Command">
    New `lua agents` command lists all organizations and agents you have access to.

    ```bash
    # List all accessible agents
    lua agents

    # JSON output for scripting
    lua agents --json
    ```

    **Use Cases:**
    - Discover agent IDs for initialization or scripts
    - Team management and access auditing
    - Automation with JSON parsing
    - Multi-agent deployment workflows

    See the [Utility Commands](/cli/utility-commands#lua-agents) documentation.
  </Accordion>

  <Accordion title="Non-Interactive Sandbox View Commands">
    New non-interactive view commands for sandbox environments.

    ```bash
    # Print sandbox persona and exit
    lua persona sandbox view

    # Print local skills and exit
    lua skills sandbox view
    ```

    Perfect for CI/CD pipelines, automation scripts, and quick reference.
  </Accordion>
</AccordionGroup>

### üîß Breaking Changes

<Warning>
These changes may affect existing scripts and workflows. Please update accordingly.
</Warning>

<AccordionGroup>
  <Accordion title="Push Flag: --version renamed to --set-version">
    The `--version` flag in push commands has been renamed to `--set-version` for clarity.

    ```bash
    # Old (no longer works)
    lua push skill --name mySkill --version 1.0.5

    # New (correct)
    lua push skill --name mySkill --set-version 1.0.5
    ```

    **Reason:** Avoids confusion with the global `--version` flag that shows CLI version.
  </Accordion>

  <Accordion title="Compile Sync: --no-sync changed to --sync (opt-in)">
    Compile now **does NOT** check for drift by default. Sync is opt-in for faster compilation.

    ```bash
    # Old behavior (sync ran by default)
    lua compile             # Checked for drift
    lua compile --no-sync   # Skipped drift check

    # New behavior (sync is opt-in)
    lua compile       # No drift check (fast)
    lua compile --sync      # Enable drift check
    ```

    **Reason:** Faster compilation by default, drift check only when needed.

    **New flag:** `--verbose` for detailed compilation output.
  </Accordion>
</AccordionGroup>

### üöÄ Improvements

<AccordionGroup>
  <Accordion title="Version Conflict Avoidance in Push">
    `lua push --force` now automatically checks the server for the highest existing version and suggests the next available version.

    **Benefit:** Prevents "Version already exists" errors during automated deployments.
  </Accordion>

  <Accordion title="Sync Compiles Before Checking Drift">
    `lua sync` now runs compilation first to ensure the manifest is fresh before comparing with server state.

    **Benefit:** More accurate drift detection with latest local changes.
  </Accordion>

  <Accordion title="Chat Preprocessor Block Response">
    Chat now displays preprocessor block response text (e.g., "Message detected as spam") instead of showing empty responses.

    **Benefit:** Better visibility into preprocessor behavior during testing.
  </Accordion>

  <Accordion title="Error Message Format">
    All errors now go through standardized `withErrorHandling()` wrapper for consistent formatting.

    ```
    Error during push: No skills found
    ```

    **Benefit:** Clearer, more actionable error messages.
  </Accordion>
</AccordionGroup>

### ‚ö° Performance

<AccordionGroup>
  <Accordion title="Parallel Server Sync During Compilation">
    Compile-time server sync now fetches all primitive types in parallel instead of sequentially.

    - **Before**: 6 sequential HTTP calls (~3-6s)
    - **After**: All fetched in parallel via `Promise.all` (~1s)

    **Benefit:** Noticeably faster `lua compile --sync` and `lua push all`.
  </Accordion>

  <Accordion title="Batch Version Checks in Push All">
    `lua push all` now batches version lookups ‚Äî one HTTP call per primitive type instead of one per entity.

    **Benefit:** Significant speedup for projects with many skills, webhooks, or jobs.
  </Accordion>

  <Accordion title="Lazy Authentication">
    Authentication is no longer validated upfront on every command. The first actual API call validates the key.

    **Benefit:** Faster command startup, especially for `compile`, `push`, and `sync`.
  </Accordion>
</AccordionGroup>

### üêõ Bug Fixes

- **Tool Conditions**: Tools without a `condition()` method no longer fail with "Tool condition evaluation failed"
- **MCP Server Push**: Fixed three bugs preventing MCP servers from being pushed (detection, manifest metadata, and push pipeline)
- **Auth Errors**: `AuthenticationError` now properly propagated during sync; added 403 Forbidden handling
- **Compile Sync**: Fixed stale config bug where handlers overwrote each other's IDs during server sync

---

## v3.5.0-alpha.3

**Released:** February 4, 2026

<Warning>
This is an alpha release for testing new features. For production use, we recommend v3.4.0.
</Warning>

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="Webhook Triggers for Integrations">
    Event-driven triggers that wake up your agent when events occur in connected services.
    
    ```bash
    # Connect with triggers (all selected by default in interactive mode)
    lua integrations connect --integration linear --auth-method oauth --scopes all \
      --triggers task_task.created,task_task.updated
    
    # Use custom webhook URL instead of agent trigger
    lua integrations connect --integration linear --auth-method oauth --scopes all \
      --triggers task_task.created --custom-webhook --hook-url https://my-server.com/webhook
    ```
    
    **Key Features:**
    - Triggers pre-selected by default in interactive mode
    - Choose between "Agent wake-up" mode or custom webhook URLs
    - Friendly labels for OAuth scopes and webhook events
    - Triggers preserved when updating connection scopes
    
    See the [Integrations Command](/cli/integrations-command) documentation for full details.
  </Accordion>

  <Accordion title="Webhooks List JSON Output">
    The `lua integrations webhooks list` command now supports JSON output and displays webhook IDs:
    
    ```bash
    # List triggers with IDs for deletion
    lua integrations webhooks list
    
    # Output as JSON for scripting
    lua integrations webhooks list --json
    ```
    
    Output includes: id, integrationType, objectType, event, webhookType, hookUrl, status, interval, connectionId.
  </Accordion>
</AccordionGroup>

### üîß Improvements

- **Push Command**: Corrected HTTP methods for webhook and job deployment with improved error handling
- **Automated Deploy**: Fully automated push & deploy with `--force --auto-deploy` flags
- **Terminology**: User-facing text uses "Integration" instead of "Account" and "Trigger" instead of "Webhook Subscription"

### üêõ Bug Fixes

- **Update Flow**: Triggers now preserved when updating connection scopes (per-trigger hookUrl and interval restored)

---

## v3.5.0-alpha.2

**Released:** January 30, 2026

<Warning>
This is an alpha release for testing new features. For production use, we recommend v3.4.0.
</Warning>

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="Integrations Command">
    Connect your agent to 250+ third-party services via [Unified.to](https://unified.to). When you connect an account, an MCP server is automatically created to expose tools to your agent.
    
    ```bash
    lua integrations              # Interactive mode
    lua integrations connect      # Connect a new account
    lua integrations list         # List connected accounts
    lua integrations webhooks     # Manage webhook subscriptions
    lua integrations mcp          # Manage MCP servers for connections
    ```
    
    **Key Features:**
    - Support for OAuth and API token authentication
    - Automatic MCP server creation and activation per connection
    - Webhook subscriptions for receiving events from connected services
    
    See the [Integrations Command](/cli/integrations-command) documentation for full details.
  </Accordion>

  <Accordion title="MCP and Mastra Log Types">
    The `lua logs` command now supports filtering by MCP tool executions and Mastra AI runtime logs:
    
    ```bash
    lua logs --type mcp      # View MCP tool execution logs
    lua logs --type mastra   # View Mastra AI runtime logs
    ```
    
    - üîå **MCP Tools**: View MCP tool execution logs with plug icon
    - üß† **Mastra Runtime**: View Mastra AI runtime logs with brain icon
  </Accordion>

  <Accordion title="User ID Filtering in Logs">
    Filter logs by specific user ID:
    
    ```bash
    lua logs --user-id user_123456
    ```
  </Accordion>

  <Accordion title="Non-Interactive Configure Command">
    The `lua configure` command now supports full non-interactive operation for CI/CD pipelines and dashboard users:
    
    ```bash
    # Direct API key setup (for dashboard users or CI/CD)
    lua configure --api-key YOUR_API_KEY

    # Request OTP via email (step 1)
    lua configure --email user@example.com

    # Verify OTP and generate API key (step 2)
    lua configure --email user@example.com --otp 123456
    ```
  </Accordion>

  <Accordion title="Post-Process Complete Event in Chat">
    The CLI now displays post-processed responses when post-processors modify the AI's response during chat streaming. A clear indicator shows when post-processing occurs.
  </Accordion>
</AccordionGroup>

### üîß Improvements

- **updateAgent API**: New `AgentApi.updateAgent()` method for partial sub-agent updates (name, persona)
- **Compile Command**: Removed `--force-sync` flag (sync is now the default behavior)

### üêõ Bug Fixes

- **Marketplace**: Browse and search commands now only display skills with published and approved versions
- **Test Command**: Fixed preprocessor test handling for `PreProcessorResult` object format

### üìù Interface Updates

- Added `MCPServerSource` enum to `interfaces/mcp.ts`
- Added `'mcp'` and `'mastra'` to `PrimitiveType` and `FilterType` enums

---

## v3.5.0-alpha.1

**Released:** January 23, 2026

<Warning>
This is an alpha release for testing new features. For production use, we recommend v3.4.0.
</Warning>

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="User Lookup by Email or Phone">
    The `User.get()` method now supports looking up users by email address or phone number, in addition to userId. This is especially useful in webhooks where you receive contact info from external systems.
    
    ```typescript
    import { User } from 'lua-cli';
    
    // Look up by email
    const user = await User.get({ email: 'customer@example.com' });
    
    // Look up by phone (both formats work)
    const user = await User.get({ phone: '+1234567890' });
    const user = await User.get({ phone: '1234567890' });
    
    // Handle not found
    if (!user) {
      return { error: 'User not found' };
    }
    ```
    
    **Use Cases:**
    - Webhooks receiving customer email/phone from external systems
    - Admin tools where operators search by contact info
    - Integrations with third-party systems that don't have Lua user IDs
    
    <Note>
    Unlike `User.get(userId)` which throws on not found, email/phone lookup returns `null`. Always check for null before using the user object.
    </Note>
  </Accordion>
</AccordionGroup>

### üìù Interface Updates

- Added `UserLookupOptions` interface for email/phone lookup
- Updated `User.get()` return type to `UserDataInstance | null`
- Exported `UserLookupOptions` and `ProfileResponse` types

---

## v3.4.0

**Released:** January 22, 2026

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="Non-Destructive Compile Sync">
    The `lua compile` command now uses a safer, non-destructive sync pattern. Instead of automatically deleting primitives on the server that aren't in your local code, it now:
    
    - **Warns** about orphaned primitives (skills, webhooks, jobs, MCP servers)
    - **Suggests** using explicit delete commands
    - **Filters** warnings to CLI-sourced skills only (ignores marketplace and manual skills)
    
    This prevents accidental data loss and gives you full control over what gets removed.
  </Accordion>

  <Accordion title="New Delete Commands">
    Explicit delete commands for managing primitives no longer in your local code:
    
    ```bash
    # Delete a skill from the server
    lua skills delete --skill-name my-old-skill
    
    # Delete a webhook
    lua webhooks delete --webhook-name old-webhook
    
    # Delete a job
    lua jobs delete --job-name deprecated-job
    ```
    
    **Features:**
    - Server lookup for orphaned items not in local YAML
    - Interactive mode with confirmation prompts
    - `--force` flag for non-interactive deletion
  </Accordion>

  <Accordion title="Streamable HTTP MCP Transport">
    Added support for the modern Streamable HTTP transport (MCP spec 2025-03-26):
    
    ```typescript
    const server = new LuaMCPServer({
      name: 'my-api',
      transport: 'streamable-http',  // New transport type
      url: 'https://mcp.example.com/mcp',
      headers: () => ({
        'Authorization': `Bearer ${env("API_KEY")}`
      })
    });
    ```
    
    **Supported transports:**
    - `'streamable-http'` - Modern MCP standard (recommended)
    - `'sse'` - Legacy Server-Sent Events transport
    
    <Warning>
    **stdio transport removed:** Local MCP servers using `stdio` transport are not supported yet. Use remote servers with `streamable-http` or `sse` instead.
    </Warning>
  </Accordion>
</AccordionGroup>

### üêõ Bug Fixes

- **Push**: Fixed crash when pushing primitives without a version field. First push now defaults to version `0.0.1` and shows "(none - first push)" in prompts.

### üìù Interface Updates

- Added `MCPStreamableHttpServerConfig` interface for streamable-http transport
- Updated `MCPTransport` type to `'sse' | 'streamable-http'`
- Added `SkillSource` type: `'cli' | 'marketplace' | 'manual'`
- Removed `MCPStdioServerConfig` (stdio not supported yet)

---

## v3.3.0

**Released:** January 20, 2026

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="Complete Non-Interactive Mode for All Commands">
    All CLI commands now support full non-interactive operation, enabling seamless automation for AI IDEs, CI/CD pipelines, and shell scripting.
    
    **Design Patterns:**
    - Consistent option naming: `--<entity>-name` and `--<entity>-version`
    - `--force` flag for skipping confirmation prompts
    - `--json` flag for machine-readable output
    - Action arguments for entity management (view, versions, deploy, activate, deactivate)
    
    ```bash
    # Entity management
    lua skills view
    lua skills versions --skill-name mySkill
    lua skills deploy --skill-name mySkill --skill-version 1.0.3
    
    # Init command
    lua init --agent-id abc123
    lua init --agent-name "My Bot" --org-id org1
    
    # Sync command
    lua sync --check    # CI drift detection
    lua sync --accept   # Auto-sync from server
    
    # Test command
    lua test skill --name get_weather --input '{"city": "London"}'
    
    # Logs command
    lua logs --type skill --name mySkill --limit 10 --json
    ```
    
    See the [Non-Interactive Mode Guide](/cli/non-interactive-mode) for complete documentation.
  </Accordion>

  <Accordion title="User Message and Agent Response Log Types">
    The logs command now supports filtering by user messages and agent responses:
    
    ```bash
    lua logs --type user_message --limit 20
    lua logs --type agent_response --limit 20
    ```
    
    - üí¨ **User Messages**: View incoming user messages with channel and userId info
    - ü§ñ **Agent Responses**: View AI-generated responses with distinct coloring
  </Accordion>

  <Accordion title="Function-Based Environment Resolution for MCP Servers">
    MCP server configurations now support dynamic environment variable resolution using the `env()` API:
    
    ```typescript
    const mcpServer = new LuaMCPServer({
      name: 'mongo-mcp',
      transport: 'stdio',
      command: 'npx',
      args: ['-y', '@mongodb/mcp-server'],
      env: () => ({
        MDB_CONNECTION_STRING: env("MDB_CONNECTION_STRING")
      })
    });
    ```
    
    Also supported for SSE transport with `url` and `headers` resolver functions.
  </Accordion>

  <Accordion title="Products.get() Filter Support">
    Added filter support to `Products.get()` with backward compatibility:
    
    ```typescript
    // Backward compatible
    const products = await Products.get(1, 10);

    // New approach with filters
    const products = await Products.get({
      page: 1,
      limit: 10,
      filter: {
        category: 'electronics',
        inStock: true
      }
    });
    ```
  </Accordion>
</AccordionGroup>

### üêõ Bug Fixes

- **Chat**: Allow `lua chat` to work without mandatory skills - agents can now have only webhooks, jobs, or processors
- **Commands**: Normalized action handling for case-insensitive action comparisons

### üîß Improvements

- **Chat Command**: Informational message when defaulting to sandbox environment
- **Chat Command**: Improved visual separation between compile logs and chat response
- **Env Command**: Proper error handling for save/delete operations
- **Push Command**: Shared helper functions reduce code duplication

---

## v3.2.0

**Released:** January 13, 2026

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="Sync Command for Drift Detection">
    New `lua sync` command to detect drift between server and local code:
    
    ```bash
    lua sync
    ```
    
    **Features:**
    - Compare agent name and persona between server state and local code
    - Fetch latest published persona version (excludes drafts and rollbacks)
    - Show colored line-by-line diff for easy comparison
    - Interactive resolution: update local from server or continue with local
    - Integrated into compile flow with `--no-sync` and `--force-sync` flags
  </Accordion>

  <Accordion title="Chat History Clear Command">
    New `lua chat clear` command to clear conversation history:
    
    ```bash
    # Clear all conversation history
    lua chat clear

    # Clear history for a specific user
    lua chat clear --user user@example.com
    ```
    
    Accepts userId, email, or mobile number as the identifier.
  </Accordion>

  <Accordion title="Lua Runtime API with Channel Type">
    New `Lua` namespace for runtime access:
    
    ```typescript
    import { Lua } from 'lua-cli';

    // Access channel information
    const channel = Lua.request.channel; // 'dev', 'webchat', 'whatsapp', etc.
    ```
    
    Channel is typed as a union type: `'dev' | 'webchat' | 'whatsapp' | 'messenger' | 'voice' | 'api' | 'email'`
  </Accordion>

  <Accordion title="Lua.request.webhook for Raw Webhook Payload">
    Access raw webhook payloads in tool execute functions:
    
    ```typescript
    import { Lua } from 'lua-cli';

    // Access raw webhook payload when triggered by webhook
    const webhookPayload = Lua.request.webhook;
    ```
  </Accordion>

  <Accordion title="Marketplace Pagination">
    Browse marketplace skills now supports pagination:
    - Navigate through pages with Previous/Next options
    - Shows page info (Page X/Y) and total count
    - Configurable page size (default: 10 items)
  </Accordion>
</AccordionGroup>

### üîß Improvements

- **Simplified Agent Creation**: Streamlined `lua init` flow with cleaner prompts
- **Better TypeScript Support**: Improved handling of path aliases and variable references in your code

### üêõ Bug Fixes

- Fixed sync command occasionally showing false drift detection
- Fixed skill publishing issues
- Fixed compilation when skills are defined inline vs imported from separate files

---

## v3.1.0

**Released:** December 7, 2025

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="MCP Server Support">
    New `LuaMCPServer` class for integrating Model Context Protocol servers with your agent:
    
    ```typescript
    import { LuaMCPServer, LuaAgent } from 'lua-cli';

    const docsServer = new LuaMCPServer({
      name: 'lua-docs',
      transport: 'sse',
      url: 'https://docs.heylua.ai/mcp/sse'
    });

    export const agent = new LuaAgent({
      mcpServers: [docsServer]
    });
    ```
    
    **CLI commands:**
    - `lua mcp` - List, activate, deactivate, or delete MCP servers
    - `lua push mcp` - Push individual MCP servers
    - MCP servers included in `lua push all --force`
  </Accordion>

  <Accordion title="Tool Conditions">
    Tools can now have a `condition` function that determines if the tool is available:
    
    ```typescript
    const adminTool = new LuaTool({
      name: 'admin-tool',
      condition: async () => {
        const user = await User.get();
        return user.data?.isAdmin === true;
      },
      execute: async (input) => { return 'admin action completed'; }
    });
    ```
    
    Use conditions to dynamically enable/disable tools based on user subscription, verification status, feature flags, or region.
  </Accordion>

  <Accordion title="CDN API">
    New `CDN` namespace for uploading and retrieving files:
    
    ```typescript
    import { CDN } from 'lua-cli';

    // Upload a file
    const file = new File([buffer], 'image.png', { type: 'image/png' });
    const fileId = await CDN.upload(file);

    // Get file
    const file = await CDN.get(fileId);
    ```
  </Accordion>

  <Accordion title="Jobs API Enhancements">
    New methods for job management:
    
    ```typescript
    // Get all jobs
    const jobs = await Jobs.getAll();

    // Activate/deactivate job scheduling
    await job.activate();
    await job.deactivate();

    // Manually trigger execution
    await job.trigger();
    ```
  </Accordion>

  <Accordion title="Evaluations Dashboard">
    New `lua evals` command opens the Evaluations Dashboard with your agent pre-configured.
    
    ```bash
    lua evals
    ```
  </Accordion>

  <Accordion title="Templates API">
    New `Templates` namespace for WhatsApp template messaging:
    
    ```typescript
    import { Templates } from 'lua-cli';

    // List templates
    const result = await Templates.whatsapp.list(channelId);

    // Send template message
    await Templates.whatsapp.send(channelId, templateId, {
      phoneNumbers: ['+447551166594'],
      values: { body: { name: 'John' } }
    });
    ```
  </Accordion>

  <Accordion title="Marketplace CLI">
    New `lua marketplace` command for discovering, installing, and publishing skills:
    
    **For Creators:**
    - Publish skills to the global marketplace
    - Version management with semantic versioning
    - Environment variable configuration per version
    
    **For Installers:**
    - Browse and search for verified skills
    - Smart installation with dependency checks
    - Interactive environment variable configuration
  </Accordion>

  <Accordion title="Enhanced Logs Command">
    The `lua logs` command now features:
    - Interactive filtering by primitive type (Skills, Jobs, Webhooks, etc.)
    - Live data from API including dynamically created jobs
    - Context-aware log display with detailed metadata
  </Accordion>

  <Accordion title="Immutable User Profile">
    New `user._luaProfile` property for read-only core user data:
    
    ```typescript
    const userId = user._luaProfile.userId;        // ‚úÖ Recommended
    const fullName = user._luaProfile.fullName;
    const emails = user._luaProfile.emailAddresses;

    // user.userId still works but is deprecated
    ```
  </Accordion>
</AccordionGroup>

### üí• Breaking Changes

<Warning>
These changes may require updates to your existing code.
</Warning>

<AccordionGroup>
  <Accordion title="JobInstance Restructured">
    `JobInstance` now receives the full `Job` entity with `activeVersion`:
    
    ```typescript
    // Before
    const schedule = job.schedule;
    const id = job.jobId;

    // After
    const schedule = job.activeVersion.schedule;
    const id = job.id;
    await job.trigger(); // New method
    ```
  </Accordion>

  <Accordion title="welcomeMessage Removed from LuaAgent">
    The `welcomeMessage` field has been removed from `LuaAgent` configuration:
    - For voice: use `voiceConfig.welcomeMessage`
    - For chat widgets: use `WebchatChannelConfig.welcomeMessage`
  </Accordion>

  <Accordion title="Webhook Execute Signature Changed">
    Webhook execute functions now receive a single event object:
    
    ```typescript
    // Before
    execute: async (query, headers, body) => {
      // handle webhook
    }

    // After
    execute: async (event) => {
      const { query, headers, body, timestamp } = event;
      // handle webhook
    }
    ```
  </Accordion>

  <Accordion title="PreProcessor Response Redesigned">
    `PreProcessorResult` now uses a discriminated union:
    
    ```typescript
    // Block response
    return { action: 'block', response: 'Blocked' };

    // Proceed response
    return { 
      action: 'proceed', 
      modifiedMessage: [{ type: 'text', text: '...' }] 
    };
    ```
    
    - `modifiedMessage` is now `ChatMessage[]` (array)
    - Added `priority` field for execution order
    - Removed `context` field
  </Accordion>
</AccordionGroup>

### üîß Improvements

- **Data API Type Safety**: `searchText` parameter added to `Data.create()` and `Data.update()`, `data` parameter type changed to `Record<string, any>`
- **PostProcessor Simplified**: Return type now requires `modifiedResponse: string`, removed `async` field
- **Compilation**: Handle `.js` extensions for Node16/NodeNext module resolution
- **Template**: Minimal by default, use `--with-examples` flag for examples
- **Web UI**: React Query, Sonner toasts, improved env panels, docs in toolbar

### üõ†Ô∏è Refactoring

- Removed `context` field from webhooks, jobs, and postprocessors
- Removed `version` field from `LuaSkill`, `LuaJob`, and processor configurations
- Improved push command: displays both `webhookId` and `webhook-name` URL formats
- Rewritten `interfaces/jobs.ts` to match `lua-api` DTOs exactly

---

## v3.0.3

**Released:** October 30, 2025

### üéØ User API Enhancement

Enhanced `User.get()` method now accepts an optional `userId` parameter:

```typescript
// Get current user (existing behavior)
const userData = await User.get();

// NEW: Get specific user by ID
const specificUser = await User.get('user_123456');
```

**Use Cases:**
- Fetch data for specific users in admin tools
- Access user information in webhooks/jobs
- Multi-user data operations
- User management features

<Note>
This enhancement allows tools, webhooks, and jobs to access any user's data, enabling more sophisticated multi-user scenarios.
</Note>

---

## v3.0.2

**Released:** October 30, 2025

### üöÄ Major Improvements to Compilation System

This release brings comprehensive dependency bundling, debug mode, enhanced validation, and critical bug fixes.

<AccordionGroup>
  <Accordion title="Comprehensive Dependency Bundling">
    All components now properly bundle external dependencies:
    
    - ‚úÖ **LuaWebhooks** bundle dependencies (e.g., Stripe, axios)
    - ‚úÖ **LuaJobs** bundle dependencies
    - ‚úÖ **PreProcessors** bundle dependencies (e.g., lodash)
    - ‚úÖ **PostProcessors** bundle dependencies (e.g., date-fns)
    - ‚úÖ **Nested Jobs** (`Jobs.create()`) independently bundle their own dependencies
    
    **Impact:** All compiled components are now truly portable and self-contained, requiring no dependency installation on deployment targets.
  </Accordion>

  <Accordion title="Debug Mode">
    Added `--debug` flag to `lua compile` command:
    
    ```bash
    lua compile --debug
    # or
    LUA_DEBUG=true lua compile
    ```
    
    **Features:**
    - Verbose step-by-step logging
    - Shows detected imports and dependencies
    - Displays bundle sizes (uncompressed and compressed)
    - Preserves temp files for inspection
    - Shows timing information for each component
    - Full error stack traces
  </Accordion>

  <Accordion title="Enhanced Validation">
    - **tsconfig.json validation** - Clear error if missing or invalid
    - **Empty bundle detection** - Warns about suspiciously small bundles (under 100 bytes)
    - **Bundle output validation** - Ensures esbuild creates valid output
    - **Null config handling** - Graceful compilation without lua.skill.yaml
    - **Safe optional chaining** - Fixed crash when agentData is null
  </Accordion>

  <Accordion title="Improved Error Handling">
    Context-aware error messages with actionable hints:
    - Dependency resolution failures ‚Üí "Run npm install"
    - TypeScript syntax errors ‚Üí "Check syntax in filename.ts"
    - Missing files ‚Üí Shows expected path
    - Full stack traces in debug mode
  </Accordion>

  <Accordion title="Import Resolution">
    Enhanced `resolveImportPath()` to support:
    - `.ts`, `.tsx`, `.js`, `.jsx` files
    - Directory imports (`index.ts`, `index.tsx`, `index.js`)
    
    **Critical Fix:** Relative imports now work correctly in Jobs, Webhooks, and Processors:
    
    ```typescript
    // ‚úÖ Now works perfectly
    import { MyService } from "../services/MyService";
    // ‚úÖ Also works
    import { MyService } from "@/services/MyService";
    ```
  </Accordion>
</AccordionGroup>

### üêõ Bug Fixes

- Fixed null reference error when compiling without LuaAgent
- Fixed crash when lua.skill.yaml is missing
- Fixed compilation with empty agent name/persona
- **Critical:** Fixed relative import resolution in all component types

### üßπ Code Quality

- Removed obsolete `dynamic-job-bundler.ts`
- Extracted common helpers (`extractRelevantImports`, `bundleAndCompressExecuteFunction`)
- Reduced bundling.ts from 1,149 to 1,036 lines (9.8% reduction)
- Added 27 comprehensive tests for bundling, execution, validation, and relative imports

---

## v3.0.0

**Released:** October 2025

### üéâ Major Release

Version 3.0.0 focuses on developer experience, deployment automation, and real-time chat capabilities.

### ‚ú® New Features

<AccordionGroup>
  <Accordion title="LuaAgent - Unified Configuration">
    The flagship feature: a single, intuitive way to configure your entire agent.
    
    **Before (v2.x):**
    ```typescript
    export const skill1 = new LuaSkill({ name: 'skill1', tools: [] });
    export const skill2 = new LuaSkill({ name: 'skill2', tools: [] });
    export const webhook1 = new LuaWebhook({ name: 'webhook1', execute: async () => 'ok' });
    ```
    
    **After (v3.0.0):**
    ```typescript
    export const agent = new LuaAgent({
      name: 'my-assistant',
      persona: 'You are a helpful AI assistant...',
      skills: [skill1, skill2],
      webhooks: [webhook1],
      jobs: [job1],
      preProcessors: [processor1],
      postProcessors: [processor2]
    });
    ```
    
    **Benefits:**
    - Single source of truth
    - Clearer organization
    - Automatic YAML synchronization
    - Better IDE support
  </Accordion>

  <Accordion title="Streaming Chat Interface">
    Real-time chat responses with improved UX:
    
    ```bash
    lua chat
    ```
    
    - ‚úÖ Animated typing indicator while waiting
    - ‚úÖ Text streams character-by-character
    - ‚úÖ Sandbox and production environment selection
    - ‚úÖ Uses `/chat/stream` endpoint for real-time updates
  </Accordion>

  <Accordion title="Batch Deployment">
    New command for deploying all components without prompts:
    
    ```bash
    # Push all with auto-versioning
    lua push all --force
    
    # Push and deploy to production
    lua push all --force --auto-deploy
    ```
    
    **What it does:**
    1. Compiles project
    2. Reads all components from `lua.skill.yaml`
    3. Increments patch versions automatically
    4. Pushes all components to server
    5. Deploys to production (if `--auto-deploy`)
    
    **Features:**
    - Auto-bumps patch versions (e.g., `1.0.0` ‚Üí `1.0.1`)
    - Perfect for CI/CD pipelines
    - Retry mechanism with exponential backoff
  </Accordion>

  <Accordion title="API Key Fallback">
    Flexible authentication with multiple sources (priority order):
    
    1. **System Keychain** (macOS Keychain, Windows Credential Vault, Linux libsecret)
    2. **Environment Variable** (`LUA_API_KEY`)
    3. **.env File** (`LUA_API_KEY=...`)
    
    **Usage in CI/CD:**
    ```bash
    export LUA_API_KEY=your-key
    lua push all --force --auto-deploy
    ```
  </Accordion>

  <Accordion title="Auto-Sync YAML and Code">
    Bidirectional synchronization ensures consistency:
    
    **On `lua init`:**
    - Agent name, persona ‚Üí YAML + `index.ts` LuaAgent
    
    **On `lua compile`:**
    - LuaAgent persona ‚Üí YAML
    
    No manual synchronization needed!
  </Accordion>
</AccordionGroup>

### üîß Improvements

<AccordionGroup>
  <Accordion title="Enhanced Bundling">
    - Excluded lua-cli internals from bundles
    - Reduced bundle sizes by 50-70%
    - Fixed relative import issues
    - Proper sandbox globals (tools use sandbox-provided APIs)
  </Accordion>

  <Accordion title="Jobs.create() Fixes">
    - `code` field now properly compressed and included
    - Execute function properly converts to strings
    - Excludes lua-cli imports from job execute functions
    - Better metadata support for passing data
  </Accordion>

  <Accordion title="Developer Experience">
    - Comprehensive template with 30+ example tools
    - Quick Start Guide for new users
    - TypeScript examples with best practices
    - CI/CD integration examples
  </Accordion>
</AccordionGroup>

### üêõ Bug Fixes

**Bundling:**
- Fixed `Cannot find module '../services/ApiService'` in pre-bundled tools
- Fixed `process.cwd is not a function` in sandbox execution
- Fixed lua-cli API code being bundled into tools

**Push & Deploy:**
- Fixed webhooks and jobs not found during `push all`
- Fixed missing `tools` array causing validation errors
- Fixed deployment timing issues with retry mechanism

**Chat:**
- Fixed welcome message reading from `lua.skill.yaml`
- Fixed streaming endpoint integration
- Fixed typing indicator cleanup on errors

### üí• Breaking Changes

<Warning>
These changes require updates to your existing code.
</Warning>

<AccordionGroup>
  <Accordion title="LuaAgent Required">
    **Old Way:**
    ```typescript
    export const skill1 = new LuaSkill({ name: 'skill1', tools: [] });
    export const skill2 = new LuaSkill({ name: 'skill2', tools: [] });
    ```
    
    **New Way:**
    ```typescript
    export const agent = new LuaAgent({
      skills: [skill1, skill2]
    });
    ```
    
    **Migration:**
    1. Wrap your existing skills in a `LuaAgent`
    2. Add `name` and `persona` fields
    3. Run `lua compile` to sync with YAML
  </Accordion>

  <Accordion title="Chat Endpoint Changed">
    - Old: `/chat/generate/:agentId`
    - New: `/chat/stream/:agentId`
    
    No action needed - handled automatically by CLI.
  </Accordion>

  <Accordion title="Jobs.create() Signature">
    Jobs must use `metadata` for data passing:
    
    ```typescript
    await Jobs.create({
      metadata: { userId: input.userId },
      execute: async (job) => {
        const userId = job.metadata.userId;
      }
    });
    ```
  </Accordion>
</AccordionGroup>

### üìä Statistics

| Metric | Before | After |
|--------|--------|-------|
| Bundle overhead | ~500KB | 50-70% smaller |
| Compilation speed | - | 30% faster |
| Template examples | 5 | 30+ |
| CLI commands | - | 25+ |

---

## Upgrade Guides

### From v3.0.x to v3.1.0

```bash
npm install lua-cli@3.1.0
```

**Required changes:**
1. Update `JobInstance` access patterns (use `activeVersion.schedule`, `id` instead of `jobId`)
2. Update webhook execute functions to use event object
3. Update PreProcessor responses to use discriminated union
4. Remove `welcomeMessage` from LuaAgent (configure on channel/voice instead)

### From v2.x to v3.0.0

```bash
npm install lua-cli@3.0.0
```

**Required changes:**
1. Wrap skills in a `LuaAgent` configuration
2. Update jobs to use `metadata` for data passing
3. Run `lua compile` to sync with YAML

```typescript
// src/index.ts
import { LuaAgent } from 'lua-cli';

export const agent = new LuaAgent({
  name: 'my-agent',
  persona: 'Your agent persona...',
  skills: [/* your existing skills */],
});
```

